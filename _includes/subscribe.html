<section id="subscribe-cta">
    <h3>Want to get blog posts over email?</h3>
    <p>Enter your email address and get notified when there's a new post!</p>
    <form>
        <input type="email" id="useremail" name="useremail" placeholder="helmholtzwatson@gmail.com"><br>
        <input type="submit" text="Subscribe">
    </form>
</section>

<style>
#subscribe-cta {
  background-color: #f7f7f9;
  border-radius: 1rem; 
  padding: 1.5em;
  margin-top: 2.5em;
}

h3 {
    margin-top: 0.5em;
}

p {
    color: #444;
}

form {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    width: 100%;
}

input[type=email] {
    border-style: none;
    font-size: 1em;
    border-radius: 0.5rem;
    min-width: 5rem;
    width: 90%;
    margin-right: 1rem;
}

input[type=submit] {
    background-color: black;
    border-radius: 0.5rem; 
    border-style: none;
    color: white;
    padding: 0.4rem;
    font-size: 1em;
}

input[type=submit]:hover {
    cursor: pointer;
    /* TODO: This is $blue. Incorporate this style into site's scss. */
    background-color: #0076df;
}

input[type=submit]:disabled {
    cursor: not-allowed;
    /* TODO: This is $blue. Incorporate this style into site's scss. */
    background-color: #444;
}


.pulse {
  background-color: #222;
  animation-name: pulsecolor;
  animation-duration: 2s;
  animation-iteration-count: infinite;
}

@keyframes pulsecolor {
  0% {
    background-color: #222;
  }
  50% {
    background-color: #4285f4;
  }
  100% {
    background-color: #222;
  }
}

.error {
    background-color: red !important;
}
</style>

<script>
    const subscribeEndpoint = "https://thundergolfer--thundergolferdotcom-email-subs-web.modal.run/subscribe";
    const form = document.querySelector('#subscribe-cta');
    const submitButton = form.querySelector('input[type=submit]');
    form.addEventListener('submit', event => {
        event.preventDefault();
        const formData = new FormData(event.target);
        const formProps = Object.fromEntries(formData);
        console.log("Form submitted!");
        console.log(formProps);
        submitButton.classList.add("pulse");
        submitButton.classList.remove("error");
        submitButton.innerText = "Waitâ€¦";
        fetch(`${subscribeEndpoint}?email=${formProps.useremail}`)
            .then((response) => {
                if (!response.ok) {
                    submitButton.classList.add("error");
                    submitButton.disabled = false;
                    submitButton.innerText = "Submit";
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                return response.json();
            })
            .then((data) => {
                submitButton.classList.remove("pulse");
                submitButton.disabled = true;
                submitButton.innerText = "Done!";
            });
    });
</script>
